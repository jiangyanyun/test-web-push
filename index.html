<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style >
        * {
            padding: 0;
            margin: 0;
        }
        .box {
          width: 200px;
          height: 200px;
          border: 1px solid red;
          margin: 20px;
        }
    </style>
    <script src="https://jiangyanyun.github.io/test-web-push/popup-online.js"></script>
    <script>
        (function(para) {
          var p = para.sdk_url, n = para.name, w = window, d = document, s = 'script',x = null,y = null;
          if(typeof(w['sensorsDataAnalytic201505']) !== 'undefined') {
              return false;
          }
          w['sensorsDataAnalytic201505'] = n;
          w[n] = w[n] || function(a) {return function() {(w[n]._q = w[n]._q || []).push([a, arguments]);}};
          var ifs = ['track','quick','register','registerPage','registerOnce','trackSignup', 'trackAbtest', 'setProfile','setOnceProfile','appendProfile', 'incrementProfile', 'deleteProfile', 'unsetProfile', 'identify','login','logout','trackLink','clearAllRegister','getAppStatus'];
          for (var i = 0; i < ifs.length; i++) {
            w[n][ifs[i]] = w[n].call(null, ifs[i]);
          }
          if (!w[n]._t) {
            x = d.createElement(s), y = d.getElementsByTagName(s)[0];
            x.async = 1;
            x.src = p;
            x.setAttribute('charset','UTF-8');
            w[n].para = para;
            y.parentNode.insertBefore(x, y);
          }
        })({
          sdk_url: 'https://jiangyanyun.github.io/test-web-push/sensorsdata.full.js',
          heatmap_url: 'https://cdn.jsdelivr.net/npm/sa-sdk-javascript@1.14.22/heatmap.min.js',
          name: 'sensors',
          heatmap: {},
          server_url: 'http://10.120.197.153:8106/sa?project=default&token=schemaLimited-KVeX4uIe'
        });
       
        sensors.quick('setPlugin',{
          popup: function(self){
            self.init({
               show_log:true,
               api_base_url:'https://apimapping.debugbox.sensorsdata.cn/10-120-111-129/8202/api/v2/',
              //  api_base_url:'http://10.120.111.129:8202/api/v2/',
               popup_listener: {
                 openlink:'auto',
                 onClick:function(plan_id,action){
                   console.log('onClick plan_id',plan_id)
                   console.log('onClick action',action)
                   alert(JSON.stringify(action));
                 },
                 onLoadSuccess:function(plan_id){
                  console.log('onLoadSuccess',plan_id)
                 },
                 onLoadFailed: function(plan_id,code,message){
                  console.log('onLoadFailed plan_id', plan_id);
                  console.log('onLoadFailed code', code);
                  console.log('onLoadFailed message', message);
                 },
                 onClose:function(plan_id){
                  console.log('onClose',plan_id)
                 }
               }
            })
          }
        })
        </script>
</head>

<body>
<h2>test Page</h2>
<button id="button">WebClick</button>
<div class="box">
    我是一个盒子
</div>
<div class="box">
  我是一个盒子
</div>
<p id="app">清空localstorage</p>
<p id="PayOrder">触发 listen 事件</p>
<div class="box">
  我是一个盒子
</div>
<div class="box">
  我是一个盒子
</div>
<div class="box">
  我是一个盒子
</div>

<a href="http://localhost:8081/popup/test/index.html">gotoIndex</a>
</body>
</html>

<script>
 document.getElementById('app').addEventListener('click',function(){
  localStorage.clear();
 })
 document.getElementById('PayOrder').addEventListener('click',function(){
   sensors.track('listen')
 })
 function setIsLoad(){
   
   var isTop = window.self === window.top;
   // h5页面
   if(isTop){
     if(window.SensorsDataWebJSSDKPlugin.popup.isLoad){
       return false;
     }else if(typeof window.SensorsDataWebJSSDKPlugin.popup.isLoad === 'undefined'){
      window.SensorsDataWebJSSDKPlugin.popup.isLoad = true;
       return true;
     }
   }else {
     try {
       // 内嵌iframe页面
        if(window.top.SensorsDataWebJSSDKPlugin.popup.isLoad){
          return false;
        }else {
          window.top.SensorsDataWebJSSDKPlugin.popup.isLoad = true;
          return true;
        }
     }catch (e){
        console.log('非同域名iframe内嵌不能获取父级窗体内容',e)
        return true;
     }
    

   }
}
if(setIsLoad()){
  alert('web push index dialog')
  }
</script>